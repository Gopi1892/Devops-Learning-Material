node {
  def remote = [:]
  remote.name = 'test'
  remote.host = '43.205.115.15' //tomcate server
  remote.user = 'ec2-user'
  remote.password = 'p'
  remote.allowAnyHosts = true
  stage('Remote SSH') {
    sshCommand remote: remote, command: "sudo yum update -y ; sudo yum install wget unzip -y"
    //Tomcat Download
    sshCommand remote: remote, command: "sudo wget https://dlcdn.apache.org/tomcat/tomcat-8/v8.5.81/bin/apache-tomcat-8.5.81.tar.gz"
    //Tocat untar
     sshCommand remote: remote, command: "sudo tar -xvf apache-tomcat-8.5.81.tar.gz"
     //Java dependecies installation
    sshCommand remote: remote, command: "sudo yum install java-1.8.0-openjdk-devel -y"
    //Tomcat start 
    sshCommand remote: remote, command: "sudo sh /home/ec2-user/apache-tomcat-8.5.81/bin/startup.sh"
    sshCommand remote: remote, command: "sudo rm -rf /home/ec2-user/apache-tomcat-8.5.81/webapps/ROOT"
    //sshCommand remote: remote, command: "hostname"
  }
}
pipeline {
    agent any
    stages {
        stage('Build') {
            steps {
                // Get some code from a GitHub repository
                git url: 'https://github.com/ShailAdmin/SampleRegistratonForm.git', branch: 'master' //jenkins server
                sh 'mvn --version'
                sh 'mvn compile'
                sh 'mvn test'
                sh 'mvn package'
                sh 'mvn install'
                //sh 'sh 'sudo scp -rp /var/lib/jenkins/workspace/p3/target/RegistrationForm.war root@43.205.115.15:/home/ec2-user/apache-tomcat-8.5.81/webapps/ROOT.war'
            }
        }
    }
}
node {
  def remote = [:]
  remote.name = 'test'
  remote.host = '43.205.115.15' //tomcat server
  remote.user = 'root'
  remote.password = 'p'
  remote.allowAnyHosts = true
  stage('Remote SSH') {
    writeFile file: 'abc.sh', text: 'ls -lrt'
    sshPut remote: remote, from: '/var/lib/jenkins/workspace/p3/target/RegistrationForm.war', into: '/home/ec2-user/apache-tomcat-8.5.81/webapps/ROOT.war'
  }
}